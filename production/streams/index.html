<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="description" content="Charlie Marsh is a programmer and student at Princeton University with major interests in functional programming and machine learning.">
  <meta name="viewport" content="width=device-width">
  <title>Streams and Lazy Computation | Charlie Marsh</title>
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Source+Code+Pro">
  <link href="http://crmarsh416.appspot.com/css/combined.css" rel="stylesheet" type="text/css" />
  <link href='https://plus.google.com/u/0/100601164815113053596/' rel='author'>
  <script type="text/javascript" src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?lang=ml"></script>
  <script type="text/javascript" data-no-instant>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-36552582-2', 'princeton.edu');
    InstantClick.on('change', function() {
      ga('send', 'pageview', location.pathname + location.search);
    });
    InstantClick.init();
  </script>
</head>

<body class="index">
  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span2 hidden-phone"></div>
      <div class="span2 hidden-phone" style="position:fixed">
          <h1 style="font-size:50px"><a class="blank" href="/~crmarsh/">Charlie<br>Marsh</a></h1>
          <p><a class="implicit" href="/~crmarsh/" data-instant>Home</a> &sdot; <a class="implicit" href="../Charles_Marsh_CV.pdf">CV</a>&sdot; <a class="implicit" href="../about.html">About</a></p>
          <h2>Programmer,<br>student.</h2>
          <p>I'm into functional<br>programming,<br>machine learning,<br> and other fun stuff.<p>
            <p>Find me on:</p>
          <a href="mailto:crmarsh@princeton.edu" class="nav email"></a>
          <a href="http://www.github.com/crm416" class="nav github"></a>
          <a href="http://stackoverflow.com/users/1450892/charles-marsh" class="nav stackoverflow"></a>
          <a href="http://uk.linkedin.com/in/marshcharles" class="nav linkedin"></a>
        </div>
        <div class="span2 visible-phone">
          <div>
            <p style="font-size:25px"><a class="blank" href="/~crmarsh/">Charlie Marsh</a>  <div style="margin-top:-10px"><code class="custom"><span class="code_red">type</span> <span class="code_blue">blog</span></code></div>
          </div>
          <hr />
        </div>
        <div class="span9 offset1" style="padding-left:20px">
          <h1>Streams and Lazy Computation</h1>
<a class="btn btn-primary" href="http://twitter.com/intent/tweet?url=http://www.princeton.edu/~crmarsh/streams&text=Streams and Lazy Computation&via=crm416">Tweet</a> | <a class="btn btn-primary" href="http://facebook.com/sharer.php?u=http://www.princeton.edu/~crmarsh/streams">Like</a> | <a class="btn btn-primary" href="https://plus.google.com/share?url=http%3A%2F%2Fwww.princeton.edu/~crmarsh/streams">+1</a>

<p>I was recently introduced to lazy computation in the context of streams—very cool (and powerful) stuff. In this post, I&#8217;ll go through streams first, then use lazy computation to address a problem specific to the data type before closing with an example.</p>

<h2 id='streams'>Streams<a class="headerlink" href="#streams" title="Permalink to this headline">¶</a></h2>

<p>A stream is an infinite data type—a “stream” of values that are generated by some computation, similar to a queue except that it is by definition infinite. I found it helpful to think of a stream as a function: the nth element in the stream can be seen as f(n).</p>

<p><strong>A stream can really be any set of values</strong>. You could have a stream of 1s (i.e., in which f(n) = 1 for all n) or a stream of the natural numbers (in which the first element is 1 and every element n is equal to the previous element plus 1) or a stream of primes or a stream of…</p>

<p>But it’s essential that you can always get the <em>next</em> element in a stream, i.e., it is infinite.</p>

<h2 id='lazy-computation'>Lazy computation<a class="headerlink" href="#lazy-computation" title="Permalink to this headline">¶</a></h2>

<p>But there’s a problem: if I just define an infinite stream of natural numbers, won’t my program run till infinity, computing every natural number (an unbounded set) and placing it in the stream? In other words: <strong>how can I abstract an infinite stream without actually computing every value?</strong></p>

<p>The answer: <strong>lazy (a.k.a. deferred) computation</strong>. The motivation here is that we don’t really need to compute the nth natural number until we need to use it—so why not just wait and be lazy about it?</p>

<p>Lazy computation tells the compiler to put off the evaluation of some expression (or set of expressions) until it is absolutely essential that the computation be performed, at which point the computation is <strong>forced</strong>.</p>

<p>In this way, we can define a stream via a function for each element and avoid actually computing every single element; but, when the element is requested, we can <em>then</em> perform the necessary computation. <strong>Thus, we avoid infinite loops and successfully implement the desired abstraction.</strong></p>

<h2 id='an-example'>An Example: powers of two<a class="headerlink" href="#an-example" title="Permalink to this headline">¶</a></h2>

<p>Consider a stream of numbers that represent all the powers of two, i.e. { 1, 2, 4, 8, 16, ... }.</p>

<p>We can actually define this stream recursively: each new element of the stream is just the current stream, with every element multiplied by 2.</p>

<p>Visually:</p>

<ul>
<li>{ 1, 2, 4, 8, 16, ... } = { 1, 2 • { 1, 2, 4, 8, ... }}</li>
<li>{ 1, 2, 4, 8, 16, ... } = { 1, 2 • { 1, 2 • { 1, 2, 4, ... }}}</li>
<li>Etc., etc.</li>
</ul>

<p>To be clear: we start with a stream with 1 as the first element; the next element is just the current stream (at this point, with a single element of 1) multiplied by 2, i.e., our new stream is {1, 2, ...}. We repeat this recursive procedure, multiplying every element of the stream by 2 for each new element generated.</p>

<h2 id='streams-in-code'>Streams, in code<a class="headerlink" href="#streams-in-code" title="Permalink to this headline">¶</a></h2>

<p>Lets view the above example (powers-of-two stream) in code. Assume:</p>

<ul>
<li>We have some map expression that applies a function t every element in the stream. For example, if each element of our stream s is generated by f(n), then map g s results in a steam s’ with each element generated by g(f(n)).</li>
<li>‘a streams are represented as pairs of (‘a, ‘a stream).</li>
</ul>

<p>Then, our code looks like:</p>

<!--?prettify lang=ml?-->

<pre><code>let rec s = (1, map (fun x -&gt; x * 2) s)
</code></pre>

<p>Oops—this code will run into an infinite loop, as s will be recursively recomputed with no termination. This is exactly the problem we described above; lets fix it with lazy computation:</p>

<!--?prettify lang=ml?-->

<pre><code>let rec s = (1, lazy (map (fun x -&gt; x * 2) s))
</code></pre>

<p>Now, we don’t have to perform any computation at all! The stream is simply initialized with no further actions. Yet, if we request the nth element, the stream will perform all the necessary computation and return the element as desired.</p>

          <p class="date">Posted on .<p>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
              var disqus_shortname = 'crmarsh416';
              (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            <br><br>
            <hr />
            <center>
              &copy; 2014 Charles Marsh
              <a href="feed.xml" style="padding-bottom:15px">
                <img class="icon" src="http://crmarsh416.appspot.com/img/rss.png">
              </a>
            </center>
          </div>
        </div>
      </div>
    <script src="http://crmarsh416.appspot.com/js/instantclick.min.js" data-no-instant></script>
    <script data-no-instant>InstantClick.init();</script>
    </body>
    </html>