<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="description" content="Adam Bard is a freelance developer living in Victoria, BC, Canada. Adam specializes in dynamic web applications using the latest technologies and methods.">
  <meta name="viewport" content="width=device-width">

  <!-- Use title if it's in the page YAML frontmatter -->
  <title>Streams and Lazy Computation
 | Charlie Marsh</title>
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Noticia+Text">
  <link href="../static/css/bootstrap.min.css" rel="stylesheet">
  <link href="../static/css/styles.css" rel="stylesheet">
  <link href="../static/css/skeleton.css" media="screen" rel="stylesheet" type="text/css" />

</head>

<body class="index">
  <div class="container">
    <div id="sidebar" class="four columns">
      <header>
        <h1 style="font-size:50px"><a class="implicit" href="index.html">Charlie Marsh</a></h1>
        <p><a class="implicit" target="_blank" href="../index.html">Home</a> &sdot; <a class="implicit" target="_blank" href="../about.html">About Me</a></p>
        <h2>Programmer, student.</h2>
        <p>I'm into functional programming,<br /> machine learning,<br /> and other fun stuff.<p>
          <p>Find me on:</p>
        </header>
        <nav>
          <ul class="posts-list">
            <li>
              <a class="implicit" target="_blank" href="http://www.github.com/crm416">GitHub</a>
            </li>
            <li>
              <a class="implicit" target="_blank" href="http://stackoverflow.com/users/1450892/charles-marsh">StackOverflow</a>
            </li>
            <li>
              <a class="implicit" target="_blank" href="http://www.quora.com/Charles-Marsh">Quora</a>
            </li>
            <li>
              <a class="implicit" target="_blank" href="mailto:crmarsh@princeton.edu">Email</a>
            </li>
          </ul>
        </nav>
      </div>
      <div class="four columns">&nbsp;
      </div>
      <div id="body" class="twelve columns">
        <section class='thing row'>
          <h1>Streams and Lazy Computation</h1>

<p>I was recently introduced to lazy computation in the context of streams—very cool (and powerful) stuff. In this post, I&#8217;ll go through streams first, then use lazy computation to address a problem specific to the data type before closing with an example.</p>

<h2>Streams</h2>

<p>A stream is an infinite data type—a “stream” of values that are generated by some computation, similar to a queue except that it is by definition infinite. I found it helpful to think of a stream as a function: the nth element in the stream can be seen as f(n).</p>

<p><strong>A stream can really be any set of values</strong>. You could have a stream of 1s (i.e., in which f(n) = 1 for all n) or a stream of the natural numbers (in which the first element is 1 and every element n is equal to the previous element plus 1) or a stream of primes or a stream of…</p>

<p>But it’s essential that you can always get the <em>next</em> element in a stream, i.e., it is infinite.</p>

<h2>Lazy computation</h2>

<p>But there’s a problem: if I just define an infinite stream of natural numbers, won’t my program run till infinity, computing every natural number (an unbounded set) and placing it in the stream? In other words: <strong>how can I abstract an infinite stream without actually computing every value?</strong></p>

<p>The answer: <strong>lazy (a.k.a. deferred) computation</strong>. The motivation here is that we don’t really need to compute the nth natural number until we need to use it—so why not just wait and be lazy about it?</p>

<p>Lazy computation tells the compiler to put off the evaluation of some expression (or set of expressions) until it is absolutely essential that the computation be performed, at which point the computation is <strong>forced</strong>.</p>

<p>In this way, we can define a stream via a function for each element and avoid actually computing every single element; but, when the element is requested, we can <em>then</em> perform the necessary computation. <strong>Thus, we avoid infinite loops and successfully implement the desired abstraction.</strong></p>

<h2>An Example: powers of two</h2>

<p>Consider a stream of numbers that represent all the powers of two, i.e. { 1, 2, 4, 8, 16, ... }.</p>

<p>We can actually define this stream recursively: each new element of the stream is just the current stream, with every element multiplied by 2.</p>

<p>Visually:</p>

<ul>
<li>{ 1, 2, 4, 8, 16, ... } = { 1, 2 • { 1, 2, 4, 8, ... }}</li>
<li>{ 1, 2, 4, 8, 16, ... } = { 1, 2 • { 1, 2 • { 1, 2, 4, ... }}}</li>
<li>Etc., etc.</li>
</ul>

<p>To be clear: we start with a stream with 1 as the first element; the next element is just the current stream (at this point, with a single element of 1) multiplied by 2, i.e., our new stream is {1, 2, ...}. We repeat this recursive procedure, multiplying every element of the stream by 2 for each new element generated.</p>

<h2>Streams, in code</h2>

<p>Lets view the above example (powers-of-two stream) in code. Assume:</p>

<ul>
<li>We have some map expression that applies a function t every element in the stream. For example, if each element of our stream s is generated by f(n), then map g s results in a steam s’ with each element generated by g(f(n)).</li>
<li>‘a streams are represented as pairs of (‘a, ‘a stream).</li>
</ul>

<p>Then, our code looks like:</p>

<pre><code class="prettyprint lang-ml">let rec s = (1, map (fun x -&gt; x * 2) s)
</code></pre>

<p>Oops—this code will run into an infinite loop, as s will be recursively recomputed with no termination. This is exactly the problem we described above; lets fix it with lazy computation:</p>

<pre><code class="prettyprint lang-ml">let rec s = (1, lazy (map (fun x -&gt; x * 2) s))
</code></pre>

<p>Now, we don’t have to perform any computation at all! The stream is simply initialized with no further actions. Yet, if we request the nth element, the stream will perform all the necessary computation and return the element as desired.</p>

<p><p class="date">Posted on December 13, 2012.<p></p>

        </section>
      </div>
    </div>

    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?lang=ml"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/js/vendor/jquery-1.8.0.min.js"><\/script>')</script>
    <script src="/js/all.js" type="text/javascript"></script>

    <script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3525624-10']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
  </html>