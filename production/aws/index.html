<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="description" content="Charlie Marsh is a programmer and student at Princeton University with major interests in functional programming and machine learning.">
  <meta name="viewport" content="width=device-width">

  <!-- Use title if it's in the page YAML frontmatter -->
  <title>The Idiot-Proof Guide to Setting Up Your Personal EC2 Instance
 | Charlie Marsh</title>
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Source+Code+Pro">
  <link href="http://crmarsh416.appspot.com/css/combined.css" rel="stylesheet" type="text/css" />
  <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?lang=ml"></script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-36552582-2', 'princeton.edu');
  ga('send', 'pageview');
  </script>
</head>

<body class="index">
  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span2 hidden-phone"></div>
      <div class="span2 hidden-phone" style="position:fixed">
        <header>
          <h1 style="font-size:50px"><a class="blank" href="/~crmarsh/">Charlie<br />Marsh</a></h1>
          <p><a class="implicit" href="/~crmarsh/">Home</a> &sdot; <a class="implicit" href="../Charles_Marsh_CV.pdf">CV</a>&sdot; <a class="implicit" href="../about.html">About</a></p>
          <h2>Programmer,<br />student.</h2>
          <p>I'm into functional<br />programming,<br />machine learning,<br /> and other fun stuff.<p>
          <p>Find me on:</p>
          </header>
          <a href="mailto:crmarsh@princeton.edu" class="nav email"></a>
          <a href="http://www.github.com/crm416" class="nav github"></a>
          <a href="http://stackoverflow.com/users/1450892/charles-marsh" class="nav stackoverflow"></a>
          <a href="http://uk.linkedin.com/in/marshcharles" class="nav linkedin"></a>
        </div>
        <div class="span2 visible-phone">
          <div>
            <p style="font-size:25px"><a class="blank" href="/~crmarsh/">Charlie Marsh</a>  <div style="margin-top:-10px"><code class="prettyprint" class="custom"><span class="code_red">type</span> <span class="code_blue">blog</span></code></div></p>
          </div>
          <hr />
        </div>
        <div class="span9 offset1">
          <h1>The Idiot-Proof Guide to Setting Up Your Personal EC2 Instance</h1>
<a class="btn btn-primary" href="http://twitter.com/intent/tweet?url=http://www.princeton.edu/~crmarsh/aws&text=The Idiot-Proof Guide to Setting Up Your Personal EC2 Instance
&via=crm416">Tweet</a> | <a class="btn btn-primary" href="http://facebook.com/sharer.php?u=http://www.princeton.edu/~crmarsh/aws">Like</a> | <a class="btn btn-primary" href="https://plus.google.com/share?url=http%3A%2F%2Fwww.princeton.edu/~crmarsh/aws">+1</a>

<p>I like SSHing into things. So I went ahead and setup my own AWS EC2 instance. Under the free tier, you can get good mileage out of an instance and use it to do whatever you please.</p>

<p>But it took me awhile to get the thing up and running properly. Here are the things I wanted to have:</p>

<ol>
<li>Easy SSH access at the press of a button (i.e., without entering a password).</li>
<li>Yet, safety and security from the attempted access of others (i.e., using RSA keys).</li>
<li>My own account on the instance (rather than, say, using <em>root</em>).</li>
<li>All the tools I use naturally on my local machine.</li>
</ol>

<p>If that experience sounds good to you, keep reading. I've pulled together the assorted posts that I used to setup my EC2 instance and assembled <strong>The Idiot-Proof Guide</strong>.</p>

<h2>Signing Up With AWS (The Boring Part)</h2>

<ul>
<li>Go to the <a href="https://portal.aws.amazon.com/gp/aws/developer/registration/index.html">AWS signup page</a>. Proceed with the signup process. Note that the information necessary to get up and running with an AWS account includes a valid <strong>credit card</strong> and a <strong>valid phone</strong> (used for verification). Have these at the ready.</li>
</ul>

<h2>Launching Your Instance (Slightly More Interesting)</h2>

<ul>
<li>After you've received your activation email, head to the <a href="https://console.aws.amazon.com/console/home?#">AWS management console</a> (this link requires you to be logged in to AWS). Click on the icon labelled 'EC2' (orange, below).</li>
</ul>

<p><img src="http://crmarsh416.appspot.com/img/aws_portal.png" alt="AWS Portal" class="center" width="700"></p>

<p><em>For those interested, 'EC2' stands for *Elastic Cloud Compute*. The service itself allows users to rent out virtual computers on which they can boot up their own images. Basically, we're booting onto some random CPU in some Amazon-owned datacenter somewhere in America.</em></p>

<ul>
<li>On the next page, hit the big blue 'Launch Instance' button, as seen below.</li>
</ul>

<p><img src="http://crmarsh416.appspot.com/img/aws_launch_instance.png" alt="Launch instance" class="center"></p>

<ul>
<li>Next, we proceed with the 'Classic Wizard'. It's at this point that we have to select our disk image. Personally, I like using Ubuntu, so the rest of this tutorial will assume that you select <em>Ubuntu Server 13.04</em> (64-bit).</li>
<li>Click-through (accepting the default settings) until you get to the 'Create a Key Pair' tab. You can read more about public/private key pairs <a href="http://en.wikipedia.org/wiki/Public-key_cryptography">here</a>. Basically, Amazon will give you a <em>your_keyname.pem</em> file which will allow you to SSH into your server. Name it whatever you want and save it locally.</li>
<li>Click through and launch your instance.</li>
</ul>

<p><img src="http://crmarsh416.appspot.com/img/aws_final.png" alt="Final configuration" class="center" width="700"></p>

<ul>
<li>Wait until your instance state goes from <em>pending</em> to <em>active</em>. For me, that took about 2-3 minutes. When you see something like this, you're golden.</li>
</ul>

<p><img src="http://crmarsh416.appspot.com/img/aws_ready.png" alt="Instance ready" class="center" width="700"></p>

<h2>Getting Onto Your Server (More Interesting Still)</h2>

<ul>
<li><p>Now that our instance is up and running, we need to make one more step before we can SSH in. That is, we need to set the file permissions of <em>your_keyname.pem</em>. To do that, use the <a href="http://stackoverflow.com/questions/1454629/aws-ssh-access-permission-denied-publickey-issue#1454647">following command</a>:</p>

<pre><code class="prettyprint">chmod 600 /path/to/your_keyname.pem
</code></pre></li>
<li>Get your EC2 name (something of the form *.compute.amazonaws.com). It'll look like this:</li>
</ul>

<p><img src="http://crmarsh416.appspot.com/img/aws_instance_name.png" alt="Instance name" class="center"></p>

<ul>
<li><p>Now, we can go ahead and SSH in. Issue the <a href="http://stackoverflow.com/questions/6394762/ssh-access-to-amazon-ec2-instance#6407649">following command</a>:</p>

<pre><code class="prettyprint">ssh -i /path/to/your_keyname.pem ubuntu@your_instance.compute.amazonaws.com
</code></pre>

<p>In my case, for example, that looks like:</p>

<pre><code class="prettyprint">ssh -i ~/Desktop/my_key.pem ubuntu@ec2-54-218-37-172.us-west-2.compute.amazonaws.com
</code></pre></li>
<li>Success! (I hope...)</li>
</ul>

<p><img src="http://crmarsh416.appspot.com/img/aws_successful_login.png" class="center" alt="Successful login"></p>

<h2>Configuring Your Account (Much More Interesting)</h2>

<ul>
<li>Ideally, you want to <a href="http://www.howtogeek.com/124950/htg-explains-why-you-shouldnt-log-into-your-linux-system-as-root/">minimize the amount of time</a> you're logged in as <em>root</em>, for security purposes. So next, we'll create our own account on the EC2 instance and set it up with the proper permissions. I'll be creating the account <em>charlie</em>.</li>
<li><p>First, we should setup password authentication so that when we add users, our instance is secure. <a href="http://stackoverflow.com/questions/8339912/allowing-users-to-ssh-to-an-ec2-ubuntu-instance#8339975">To do so</a>:</p>

<pre><code class="prettyprint">sudo vi /etc/ssh/sshd_config
# Change the line "PasswordAuthentication no" to "PasswordAuthentication yes"
</code></pre>

<p>Notice that we need to use <em>sudo</em>.</p></li>
<li><p>Next, we'll add our user <a href="http://www.edukatr.com/how-to-start-an-ec2-ubuntu-server-for-your-developer-in-6-minutes/">as follows</a>:</p>

<pre><code class="prettyprint">sudo useradd -d /home/charlie -m charlie
sudo passwd charlie
# Enter password, twice
</code></pre></li>
<li><p>That's great! But <em>charlie</em> still isn't sudo. If you don't know what that means: in short, a sudo user is able to access files reserved for admins. We want our account to have these admin privileges. So to provide that, we type the following (still on <em>ubuntu</em>):</p>

<pre><code class="prettyprint">sudo visudo
# After line "root ALL=(ALL:ALL) ALL", add "charlie ALL=(ALL:ALL) ALL"
</code></pre>

<p>Note: if you don't want to be prompted to enter your password, then <a href="http://www.ducea.com/2006/06/18/linux-tips-password-usage-in-sudo-passwd-nopasswd/">use</a> "charlie ALL = NOPASSWD:ALL" instead.</p></li>
<li><p>At this point, <strong>we can SSH in</strong> as <em>charlie</em>! Lets give it a try. Before closing our current instance, lets reload the SSH file for good measure. Still as <em>ubuntu</em>, type:</p>

<pre><code class="prettyprint">sudo /etc/init.d/ssh restart
logout
</code></pre>

<p>Now back in the terminal, we can go ahead and login:</p>

<pre><code class="prettyprint">ssh charlie@ec2-54-218-37-172.us-west-2.compute.amazonaws.com
# charlie@ec2-54-218-37-172.us-west-2.compute.amazonaws.com's password:
</code></pre></li>
<li><p>We're in! Last thing (for now): when I created my new user account, it didn't default to the bash shell. So I lacked tab-to-autocomplete, up-arrow-for-last-command, etc. To fix that:</p>

<pre><code class="prettyprint">sudo chsh -s /bin/bash
</code></pre>

<p>Logout and login. You'll know you're successful if you see:</p>

<pre><code class="prettyprint">charlie@ip-172-31-23-65:~$
</code></pre></li>
<li>Now we'll make this login flow much smoother.</li>
</ul>

<h2>Smoothing Out The Workflow (Much, Much More Interesting)</h2>

<ul>
<li>Now, I want to be able to SSH in with the click of a button. To do that, we'll: 1) remove the need for typing in your password when SSHing from your local machine, and 2) create an alias for the SSH command (and its arguments).</li>
<li><p>To avoid the need to enter our password, we need to take some careful steps and create a <a href="http://blakesmith.me/2010/02/08/understanding-public-key-private-key-concepts.html">public-private key pair</a>. If you already have a private key that you want to use, continue to the next step. Otherwise, we first create a private-public key pair on our local machine in ~/.ssh:</p>

<pre><code class="prettyprint">cd /Users/crmarsh/.ssh/
ssh-keygen -t rsa
# Name your key. Add a password, if you want.
</code></pre>

<p>If you didn't use the default key name, you need to <a href="https://wiki.hpcc.msu.edu/display/hpccdocs/Adding+a+Private+Key+to+Your+Mac+OSX+Keychain">add the private key</a> (the version <em>without</em> the .pub extension) to your keychain as follows:</p>

<pre><code class="prettyprint">ssh-add -K keyname
</code></pre>

<p>Next, we need to move the <strong>public</strong> key to our server. Note that I'm assuming this is still your fresh EC2 instance; it <em>should</em> still be okay if you have an existing setup, but I can't make any promises. We proceed <a href="http://www.linuxproblem.org/art_9.html">as follows</a>:</p>

<pre><code class="prettyprint">scp keyname.pub charlie@ec2-54-218-37-172.us-west-2.compute.amazonaws.com:
# SSH in
ssh charlie@ec2-54-218-37-172.us-west-2.compute.amazonaws.com
# Add key to list of authorized keys
mkdir .ssh
touch .ssh/authorized_keys
cat keyname.pub &gt;&gt; .ssh/authorized_keys
# Set permissions
chmod 700 .ssh
chmod 0640 .ssh/authorized_keys
rm keyname.pub
</code></pre>

<p>Logout, and you should be able to SSH in without having to enter your password.</p></li>
<li><p>To <a href="http://askubuntu.com/questions/17536/how-do-i-create-a-permanent-bash-alias#17538">create the alias</a>, go to your bash<em>profile (emacs ~/.bash</em>profile) or wherever you configure your local bash settings. Add the following two lines (with your arguments substituted):</p>

<pre><code class="prettyprint">export AWS='ec2-54-245-139-10.us-west-2.compute.amazonaws.com'
alias aws='ssh -i ~/Desktop/crm_key.pem crmarsh@$AWS'
</code></pre>

<p>Why both? Well, if you ever need the address of your instance (it comes in handy), you can just type 'echo $AWS'. And when you want to login, you can just type 'aws' on its own. Try it for yourself.</p></li>
<li>As a final note: if you're like me and you love Sublime Text, I highly recommend using <a href="http://wbond.net/sublime_packages/sftp">Sublime SFTP</a>. It lets you edit files on your remote server using Sublime Text over SFTP.</li>
</ul>

<h2>Installing Essential Tools</h2>

<ul>
<li>Thankfully, most of the things you need come pre-installed on Ubuntu; so this section is small. Try 'em out: ssh, scp, grep, wget, etc.</li>
<li><p>However, there were still some things I wanted: emacs (not sure why, but I still use it), git, make, etc. Obviously, preferences will vary from dev to dev. Here are some commands you might want to use, for your convenience:</p>

<pre><code class="prettyprint">sudo apt-get install emacs
sudo apt-get install git
sudo apt-get install make
...
</code></pre></li>
</ul>

          <p class="date">Posted on June 19, 2013.<p>
          <div id="disqus_thread"></div>
          <script type="text/javascript">
          var disqus_shortname = 'crmarsh416';
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          <br /><br />
          <hr />
          <center>
              &copy; 2013 Charles Marsh
              <a href="feed.xml" style="padding-bottom:15px">
              <img class="icon" src="http://crmarsh416.appspot.com/img/rss.png">
              </a>
          </center>
        </div>
      </div>
    </div>
  </body>
</html>