<!DOCTYPE html>

<meta charset=utf-8>
<title>Untitled</title>
<link rel=stylesheet href=../backup.css>

<body class=post>

<article class=regular id=p-36428091926>
<p class=meta><span class=date>11/24/2012 06:26:00</span>
<a class=llink href=../posts/36428091926.html>¶</a>
<a href=http://crm416.tumblr.com/post/36428091926 rel=canonical>●</a></p>
<h2>iOS Performance: Shadows with Bezier Paths</h2>
<p><p class="MsoNormal">I spent some time yesterday fixing some performance issues related to <a href="https://itunes.apple.com/us/app/everycollegecal/id554462715?mt=8">EveryCollegeCal</a> (my iOS app). Basically, I was seeing very slow, choppy segues between the first two views (one of which is a welcome screen, the other a table view). On top of that, the scrolling performance of the latter view was equally gross.</p>
<p class="MsoNormal">In the end, the fixes were not too involved—i.e., they didn’t involve a spectacular amount of code (of course, this can’t be said of all performance issues, so I count myself lucky). And there were only two necessary changes: the choppy segues were fixed by swapping out my glossy button library, which was apparently very inefficient. But the second change demonstrates something cool about iOS performance tweaks: while they’re often subtle, the under-the-hood explanations are always logical.</p>
<p class="MsoNormal"><u>Drop Shadows</u></p>
<p class="MsoNormal">I thought for a while that my poor scrolling performance was due to the cells themselves, which use resizable assets to create a gradient background. But after rolling the app with certain features of the table disabled, <strong>I figured out that the issue was caused by the drop shadow in my cells’ accessories—such a tiny detail.</strong></p>
<p class="MsoNormal">It’s very easy to add drop shadows to your views in iOS. What’s not so easy is making sure that they have good performance.</p>
<p class="MsoNormal">Previously, I was adding a drop shadow with CALayer (<a class="gist" href="https://gist.github.com/4139881">Code</a>).</p>
<p class="MsoNormal">This looks great and requires minimal code but—as outlined <a href="http://markpospesel.wordpress.com/2012/04/03/on-the-importance-of-setting-shadowpath/">here</a>—there’s a huge expense associated the process, namely because you must render (offscreen) the exact shape of the view; i.e., your device will spend time figuring out if your view is circular, rectangular, hexagonal, etc.</p>
<p class="MsoNormal">The fix: specify the shape of the shadow using a <strong>Bezier path</strong>. Just add this line of code (replacing &#8220;&#8230;withOvalInRect&#8221; with the appropriate shape&#8221;):</p>
<p class="MsoNormal"><span>       disclosureIndicator.</span><span>layer</span><span>.</span><span>shadowPath</span><span> = [</span><span>UIBezierPath </span><span>bezierPathWithOvalInRect</span><span>:disclosureIndicator.</span><span>layer</span><span>.</span><span>bounds</span><span>].</span><span>CGPath</span><span>;</span></p>
<p class="MsoNormal">It’s a simple fix, but I can’t emphasize enough how drastically it improved my table’s scroll performance. And the reasoning behind it is simple enough: with the latter method, you save the machine having to calculate the shape of an object.</p>
<p class="MsoNormal">This is a great example of iOS performance tweaks: subtle, but logical.</p>
<p class=tags>#iOS #performance #Core Animation</p>
</article>
