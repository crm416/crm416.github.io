<!DOCTYPE html>
  <head>
  <meta charset="utf-8">
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="description" content="Charlie Marsh is a machine learning engineer at Spring Discovery.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Streams and Lazy Computation | Charlie Marsh</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,600" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300" rel="stylesheet">
  <link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <link href="/static/css/styles.css" rel="stylesheet" type="text/css" />
  <link href="/static/css/styles-mobile.css" rel="stylesheet" type="text/css" media="(max-width: 767px)" />
  <link href="/static/css/syntax.css" rel="stylesheet" type="text/css" />
  <link href="https://plus.google.com/u/0/100601164815113053596/" rel='author'>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-36552582-3', 'auto');
    ga('send', 'pageview');
  </script>
</head>

  <body class="index">
    <div class="container-fluid">
      <div class="row">
  <div class="col-sm-12 hidden-xs">
    <center>
      <h1
        style="font-size:80px; margin-top: 0.5em;margin-bottom:0"
      >
        <a class="implicit" href="/">
          Charlie Marsh
        </a>
      </h1>
      <div style="margin-bottom: 12px">
        <code style="font-size:18px">
          <span class="code-red">type</span> <a class="implicit" href="/all/">blog</a> = <span class="code-orange">Post</span> <span class="code-red">of</span> (<span class="code-blue">string</span> <span class="code-red">*</span> <a class="implicit" href="/all/">blog</a>) | <a class="implicit code-orange" href="/">Home</a> | <a class="implicit code-orange" href="/about/">About</a>
        </code>
      </div>
      <a target="_blank" href="mailto:charlie.r.marsh@gmail.com">Email</a>
      &sdot;
      <a target="_blank" href="http://www.github.com/crm416">GitHub</a>
      &sdot;
      <a target="_blank" href="https://twitter.com/charliermarsh">Twitter</a>
      &sdot;
      <a target="_blank" href="/static/pdf/Charlie_Marsh_Resume.pdf">Résumé</a>
    </center>
    <hr />
  </div>
</div>

      <div class="row">
        <div class="col-sm-10 col-sm-offset-1 col-xs-12">
          
          
          <h1 style="margin-top: 0.25em" id="Streams-and-Lazy-Computation">
            <a class="implicit" href="#Streams-and-Lazy-Computation">
              Streams and Lazy Computation
            </a>
          </h1>
          <p>I was recently introduced to lazy computation in the context of streams—very cool (and powerful) stuff. In this post, I&#8217;ll go through streams first, then use lazy computation to address a problem specific to the data type before closing with an example.</p>

<!--break-->

<p><h2  id='Streams'><a class='implicit' href="#Streams" title="Permalink to this headline">Streams</a></h2 ></p>

<p>A stream is an infinite data type—a “stream” of values that are generated by some computation, similar to a queue except that it is by definition infinite. I found it helpful to think of a stream as a function: the nth element in the stream can be seen as f(n).</p>

<p><strong>A stream can really be any set of values</strong>. You could have a stream of 1s (i.e., in which f(n) = 1 for all n) or a stream of the natural numbers (in which the first element is 1 and every element n is equal to the previous element plus 1) or a stream of primes or a stream of…</p>

<p>But it&#39;s essential that you can always get the <em>next</em> element in a stream, i.e., it is infinite.</p>

<p><h2  id='Lazy-computation'><a class='implicit' href="#Lazy-computation" title="Permalink to this headline">Lazy computation</a></h2 ></p>

<p>But there&#39;s a problem: if I just define an infinite stream of natural numbers, won&#39;t my program run till infinity, computing every natural number (an unbounded set) and placing it in the stream? In other words: <strong>how can I abstract an infinite stream without actually computing every value?</strong></p>

<p>The answer: <strong>lazy (a.k.a. deferred) computation</strong>. The motivation here is that we don&#39;t really need to compute the nth natural number until we need to use it—so why not just wait and be lazy about it?</p>

<p>Lazy computation tells the compiler to put off the evaluation of some expression (or set of expressions) until it is absolutely essential that the computation be performed, at which point the computation is <strong>forced</strong>.</p>

<p>In this way, we can define a stream via a function for each element and avoid actually computing every single element; but, when the element is requested, we can <em>then</em> perform the necessary computation. <strong>Thus, we avoid infinite loops and successfully implement the desired abstraction.</strong></p>

<p><h2  id='An-Example-powers-of-two'><a class='implicit' href="#An-Example-powers-of-two" title="Permalink to this headline">An Example: powers of two</a></h2 ></p>

<p>Consider a stream of numbers that represent all the powers of two, i.e. { 1, 2, 4, 8, 16, ... }.</p>

<p>We can actually define this stream recursively: each new element of the stream is just the current stream, with every element multiplied by 2.</p>

<p>Visually:</p>

<ul>
<li>  { 1, 2, 4, 8, 16, ... } = { 1, 2 • { 1, 2, 4, 8, ... }}</li>
<li>  { 1, 2, 4, 8, 16, ... } = { 1, 2 • { 1, 2 • { 1, 2, 4, ... }}}</li>
<li>  Etc., etc.</li>
</ul>

<p>To be clear: we start with a stream with 1 as the first element; the next element is just the current stream (at this point, with a single element of 1) multiplied by 2, i.e., our new stream is {1, 2, ...}. We repeat this recursive procedure, multiplying every element of the stream by 2 for each new element generated.</p>

<p><h2  id='Streams-in-code'><a class='implicit' href="#Streams-in-code" title="Permalink to this headline">Streams, in code</a></h2 ></p>

<p>Lets view the above example (powers-of-two stream) in code. Assume:</p>

<ul>
<li>  We have some map expression that applies a function t every element in the stream. For example, if each element of our stream s is generated by f(n), then map g s results in a steam s&#39; with each element generated by g(f(n)).</li>
<li>  &#39;a streams are represented as pairs of (&#39;a, &#39;a stream).</li>
</ul>

<p>Then, our code looks like:</p>

<!--?prettify lang=ml?-->
<div class="highlight"><pre><code class="language-text" data-lang="text">let rec s = (1, map (fun x -&gt; x * 2) s)
</code></pre></div>
<p>Oops—this code will run into an infinite loop, as s will be recursively recomputed with no termination. This is exactly the problem we described above; lets fix it with lazy computation:</p>

<!--?prettify lang=ml?-->
<div class="highlight"><pre><code class="language-text" data-lang="text">let rec s = (1, lazy (map (fun x -&gt; x * 2) s))
</code></pre></div>
<p>Now, we don&#39;t have to perform any computation at all! The stream is simply initialized with no further actions. Yet, if we request the nth element, the stream will perform all the necessary computation and return the element as desired.</p>

          <p class="date">
            Posted on December 13, 2012.
          </p>
          <div class="hidden-xs">
  <hr />
  <center style="padding-bottom: 20px">
    &copy; 2018 <a href="/" class="implicit">Charlie Marsh</a>
  </center>
</div>

        </div>
      </div>
    </div>
  </body>
</html>
